{% extends 'base.html' %}
{% load static %}

{% block title %}
    {{ course.seo_course_title|default:course.course_title }} | LaunchDev
{% endblock title %}

{% block meta %}
    <meta name="description" content="{{ course.seo_course_description }}">
    <meta name="keywords" content="{{ course.seo_course_keywords }}">
{% endblock meta %}

{% block content %}

{% include 'partials/_messages.html' %}

<!-- Course Detail Stylesheet -->
<link href="{% static 'css/course-detail.css' %}" rel="stylesheet">

<section class="course-detail">
    <div class="container">
        <div class="row">
            
            <!-- Main Content Column -->
            <div class="col-lg-8">
                
                <!-- Hero Image - Constrained -->
                {% if course.course_image %}
                <img src="{{ course.course_image.url }}" 
                     class="course-hero-image" 
                     alt="{{ course.course_title }}">
                {% endif %}

                <!-- Course Title -->
                <h1 class="course-title">{{ course.course_title }}</h1>

                <!-- Course Description - Structured with Semantic HTML -->
                <div class="course-description">
                    
                    {% if course.course_description %}
                    <!-- Overview Section -->
                    <h2 class="course-section-title">Course Overview</h2>
                    <p>{{ course.course_description }}</p>
                    {% endif %}

                    <!-- What You'll Learn Section -->
                    <h2 class="course-section-title">What You'll Learn</h2>
                    <ul class="course-features">
                        <li>Master core concepts and fundamentals</li>
                        <li>Build real-world projects from scratch</li>
                        <li>Learn industry best practices and patterns</li>
                        <li>Gain hands-on experience with practical exercises</li>
                        <li>Get lifetime access to course materials</li>
                    </ul>

                    <!-- Why This Course Section -->
                    <h2 class="course-section-title">Why Choose This Course?</h2>
                    <p>
                        This course is designed for learners who want to build practical skills 
                        quickly. Our structured curriculum takes you from beginner to confident 
                        practitioner through hands-on projects and real-world examples.
                    </p>
                    
                    <h3 class="course-subsection-title">Course Benefits</h3>
                    <ul class="course-features bullet-style">
                        <li>Self-paced learning ‚Äî study on your own schedule</li>
                        <li>Expert instruction with clear explanations</li>
                        <li>Downloadable resources and code examples</li>
                        <li>Mobile-friendly ‚Äî learn anywhere, anytime</li>
                    </ul>

                </div>

                <!-- Course Content List -->
                {% if lectures %}
                <div class="course-content-card">
                    <div class="course-content-header">
                        <h3>Course Content</h3>
                        <span class="lecture-count-badge">{{ lectures|length }} lectures</span>
                    </div>
                    
                    <div class="lecture-list">
                        {% for lecture in lectures %}
                        <div class="lecture-item">
                            <span class="lecture-title">
                                {% if enrolled %}
                                <span class="lecture-icon unlocked">‚ñ∂</span>
                                {% else %}
                                <span class="lecture-icon locked">üîí</span>
                                {% endif %}
                                {{ lecture.lecture_title }}
                            </span>
                            
                            {% if enrolled %}
                            <button type="button" 
                                    class="btn btn-sm btn-outline-primary" 
                                    data-toggle="modal" 
                                    data-target="#Modal{{ lecture.id }}">
                                Watch
                            </button>
                            {% endif %}
                        </div>

                        {% if enrolled %}
                        <!-- Video Modal -->
                        <div class="modal fade" id="Modal{{ lecture.id }}" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header border-0">
                                        <h6 class="modal-title">{{ lecture.lecture_title }}</h6>
                                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                            <span aria-hidden="true">&times;</span>
                                        </button>
                                    </div>
                                    <div class="modal-body p-0">
                                        {% if lecture.lecture_file %}
                                        <video width="100%" controls preload="metadata">
                                            <source src="{{ lecture.lecture_file.url }}" type="video/mp4">
                                        </video>
                                        {% else %}
                                        <div class="alert alert-warning m-3">Video not available.</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>
                {% endif %}

            </div>

            <!-- Sidebar - Sticky Enroll Card -->
            <div class="col-lg-4">
                <div class="enroll-sidebar">
                    <div class="enroll-card">
                        
                        {% if enrolled %}
                        <!-- Enrolled State -->
                        <a href="{% url 'courses:lecture' course.course_slug %}" 
                           class="btn-enroll btn-start-learning">
                            <span class="me-2">‚ñ∂</span> Start Learning
                        </a>
                        <p class="enrollment-status">
                            <span class="me-1">‚úì</span> You're enrolled!
                        </p>
                        
                        {% else %}
                        <!-- Not Enrolled State -->
                        <div class="price-tag">Free</div>
                        <a href="{% url 'courses:enroll' course.id %}" 
                           class="btn-enroll">
                            Enroll Now
                        </a>
                        <p class="subtext">Full lifetime access</p>
                        {% endif %}

                        {% if lectures %}
                        <hr>
                        
                        <h4 style="font-size: 0.95rem; color: #2D3748; margin-bottom: 0.75rem; font-weight: 600;">
                            This course includes:
                        </h4>
                        <ul class="course-includes">
                            <li>
                                <span class="icon">üìπ</span>
                                {{ lectures|length }} video lectures
                            </li>
                            <li>
                                <span class="icon">üì±</span>
                                Mobile & desktop access
                            </li>
                            <li>
                                <span class="icon">‚ôæÔ∏è</span>
                                Lifetime access
                            </li>
                            <li>
                                <span class="icon">üìù</span>
                                Downloadable resources
                            </li>
                        </ul>
                        {% endif %}
                        
                    </div>
                </div>
            </div>

        </div>
    </div>
</section>

{% endblock content %}