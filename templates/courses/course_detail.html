{% extends 'base.html' %}

{% block title %}
    {{ course.seo_course_title }}
{% endblock title %}

{% block meta %}
    <meta name="description" content="{{ course.seo_course_description }}">
    <meta name="keywords" content="{{ course.seo_course_keywords }}">
{% endblock meta %}

{% block content %}

{% include 'partials/_messages.html' %}

<div class="py-5 bg-light">
    <div class="container">

        <div class="row">
            <!-- Main Content -->
            <div class="col-lg-8">
                {% if course.course_image %}
                <img src="{{ course.course_image.url }}" class="img-fluid rounded shadow-sm mb-4" alt="{{ course.course_title }}" style="width: 100%; max-height: 400px; object-fit: cover;">
                {% endif %}

                <h1 class="h2 mb-3">{{ course.course_title }}</h1>
                <p class="text-muted mb-4">{{ course.course_description }}</p>

                <!-- Course Content List -->
                {% if lectures %}
                <div class="card border-0 shadow-sm">
                    <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">Course Content</h5>
                        <span class="badge bg-primary">{{ lectures|length }} lectures</span>
                    </div>
                    <ul class="list-group list-group-flush">
                        {% for lecture in lectures %}
                        <li class="list-group-item d-flex justify-content-between align-items-center py-3">
                            <span>
                                {% if enrolled %}
                                <span class="text-primary me-2">‚ñ∂</span>
                                {% else %}
                                <span class="text-muted me-2">üîí</span>
                                {% endif %}
                                {{ lecture.lecture_title }}
                            </span>
                            {% if enrolled %}
                            <button type="button" class="btn btn-sm btn-outline-primary" data-bs-toggle="modal" data-bs-target="#Modal{{ lecture.id }}">
                                Watch
                            </button>
                            {% endif %}
                        </li>

                        {% if enrolled %}
                        <!-- Video Modal -->
                        <div class="modal fade" id="Modal{{lecture.id}}" tabindex="-1" aria-hidden="true">
                            <div class="modal-dialog modal-lg modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header border-0">
                                        <h6 class="modal-title">{{ lecture.lecture_title }}</h6>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body p-0">
                                        {% if lecture.lecture_file %}
                                        <video width="100%" controls preload="metadata">
                                            <source src="{{ lecture.lecture_file.url }}" type="video/mp4">
                                        </video>
                                        {% else %}
                                        <div class="alert alert-warning m-3">Video not available.</div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </ul>
                </div>
                {% endif %}
            </div>

            <!-- Sidebar - Sticky Enroll Card -->
            <div class="col-lg-4">
                <div class="card border-0 shadow-sm sticky-top" style="top: 1rem;">
                    <div class="card-body p-4">
                        {% if enrolled %}
                        <a href="{% url 'lecture' course.course_slug %}" class="btn btn-primary btn-lg w-100 mb-3">
                            <span class="me-2">‚ñ∂</span> Start Learning
                        </a>
                        <p class="text-success text-center small mb-0">
                            <span class="me-1">‚úì</span> You're enrolled!
                        </p>
                        {% else %}
                        <div class="text-center mb-3">
                            <span class="h3 fw-bold text-success">Free</span>
                        </div>
                        <a href="{% url 'enroll' course.id %}" class="btn btn-success btn-lg w-100 mb-3">
                            Enroll Now
                        </a>
                        <p class="text-muted text-center small mb-0">
                            Full lifetime access
                        </p>
                        {% endif %}

                        {% if lectures %}
                        <hr class="my-3">
                        <ul class="list-unstyled small text-muted mb-0">
                            <li class="mb-2"><span class="me-2">üìπ</span> {{ lectures|length }} video lectures</li>
                            <li class="mb-2"><span class="me-2">üì±</span> Mobile & desktop access</li>
                            <li><span class="me-2">‚ôæÔ∏è</span> Lifetime access</li>
                        </ul>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock content %}