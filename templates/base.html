{% load static %}

<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Mobile-first meta tags -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">

    <title>
        {% block title %}
        Courses
        {% endblock title %}
    </title>

    {% block meta %}
    <meta name="description" content="EDU E-Learning Project">
    <meta name="keywords" content="EDU, Online Courses, E-Learning">
    {% endblock meta %}

    <meta name="author" content="Vijay Thapa">

    <link rel="canonical" href="">

    <!-- Bootstrap 5 CSS -->
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
    <link href="{% static 'css/signin.css' %}" rel="stylesheet">

    <!-- Favicons -->
    <link rel="apple-touch-icon" href="{% static 'images/favicon.jpg' %}" sizes="180x180">
    <link rel="icon" href="{% static 'images/favicon.jpg' %}" sizes="32x32" type="image/jpg">
    <link rel="icon" href="{% static 'images/favicon.jpg' %}" sizes="16x16" type="image/jpg">
    <meta name="theme-color" content="#563d7c">

    <!-- Global styles -->
    <link href="{% static 'css/base.css' %}" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="{% static 'css/album.css' %}" rel="stylesheet">
    <!-- Background patterns -->
    <link href="{% static 'css/backgrounds.css' %}" rel="stylesheet">
  </head>

  <body>
    <!-- Toast Container for notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <header>
      <!-- Modern Bootstrap 5 Navbar with Active Highlight -->
      <nav class="navbar navbar-expand-lg navbar-light bg-white border-bottom">
        <div class="container">
          <a class="navbar-brand d-flex align-items-center" href="{% url 'courses:home' %}">
            <img src="{% static 'images/logo.png' %}" alt="EDU" width="32" class="me-2"/>
            <span class="fw-semibold">EDU</span>
          </a>

          <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>

          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'home' %}active{% endif %}" href="{% url 'courses:home' %}">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link {% if request.resolver_match.url_name == 'courses' %}active{% endif %}" href="{% url 'courses:courses' %}">Courses</a>
              </li>
              <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle {% if request.resolver_match.url_name == 'topic-courses' %}active{% endif %}" href="#" id="categoriesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                  Categories
                </a>
                <ul class="dropdown-menu" aria-labelledby="categoriesDropdown">
                  {% for topic in topics %}
                    <li><a class="dropdown-item" href="{% url 'courses:topic-courses' topic.topic_slug %}">{{ topic }}</a></li>
                  {% endfor %}
                </ul>
              </li>
            </ul>

            <form class="d-flex me-3" method="get" action="{% url 'courses:search-courses' %}">
              <input class="form-control" type="search" name="q" placeholder="Search courses..." aria-label="Search">
            </form>

            {% if user.is_authenticated %}
              <ul class="navbar-nav">
                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="myCoursesDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    My Courses
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="myCoursesDropdown">
                    {% if enrolled_courses %}
                      {% for enrolled_course in enrolled_courses %}
                        <li><a class="dropdown-item" href="{% url 'courses:lecture' enrolled_course.course.course_slug %}"><small>{{ enrolled_course.course.course_title }}</small></a></li>
                      {% endfor %}
                      <li><hr class="dropdown-divider"></li>
                    {% endif %}
                    <li><a class="dropdown-item" href="{% url 'courses:enrolled-courses' %}">See All</a></li>
                  </ul>
                </li>

                <li class="nav-item dropdown">
                  <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                    {{ user.username }}
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <li><a class="dropdown-item" href="{% url 'users:profile' %}">Profile</a></li>
                    <li><a class="dropdown-item" href="{% url 'account_change_password' %}">Change Password</a></li>
                    <li><hr class="dropdown-divider"></li>
                    <li>
                      <form method="post" action="{% url 'account_logout' %}">
                        {% csrf_token %}
                        {% if redirect_field_value %}
                          <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}"/>
                        {% endif %}
                        <button type="submit" class="dropdown-item">Log Out</button>
                      </form>
                    </li>
                  </ul>
                </li>
              </ul>
            {% else %}
              <a href="{% url 'account_login' %}" class="btn btn-outline-secondary me-2">Log in</a>
              <a href="{% url 'account_signup' %}" class="btn btn-primary">Sign up</a>
            {% endif %}
          </div>
        </div>
      </nav>
    </header>

    <main role="main">
      {% block content %}
      {% endblock content %}
    </main>

    <!-- Minimal clean footer -->
    <footer class="py-4 mt-auto border-top bg-white">
      <div class="container">
        <div class="row align-items-center">
          <div class="col-md-6 text-center text-md-start mb-3 mb-md-0">
            <div class="d-flex align-items-center justify-content-center justify-content-md-start">
              <img src="{% static 'images/logo.png' %}" alt="EDU" width="24" class="me-2"/>
              <span class="fw-semibold">EDU</span>
            </div>
            <p class="text-muted small mb-0 mt-2">&copy; {% now "Y" %} EDU. All rights reserved.</p>
          </div>
          <div class="col-md-6 text-center text-md-end">
            <a href="{% url 'courses:home' %}" class="text-muted text-decoration-none small me-3">Home</a>
            <a href="{% url 'courses:courses' %}" class="text-muted text-decoration-none small me-3">Courses</a>
            <a href="#" class="text-muted text-decoration-none small">Back to top</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Bootstrap 5 JS Bundle (no jQuery needed) -->
    <script src="{% static 'js/bootstrap.bundle.min.js'%}"></script>
    
    <!-- Toast notification helper -->
    <script>
      function showToast(message, type = 'success') {
        const container = document.getElementById('toastContainer');
        const toastId = 'toast-' + Date.now();
        const bgClass = type === 'success' ? 'bg-success' : type === 'error' ? 'bg-danger' : 'bg-primary';
        
        const toastHtml = `
          <div id="${toastId}" class="toast align-items-center text-white ${bgClass} border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
              <div class="toast-body">${message}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
          </div>
        `;
        
        container.insertAdjacentHTML('beforeend', toastHtml);
        const toast = new bootstrap.Toast(document.getElementById(toastId), { delay: 4000 });
        toast.show();
        
        document.getElementById(toastId).addEventListener('hidden.bs.toast', function() {
          this.remove();
        });
      }
    </script>
  </body>
</html>
